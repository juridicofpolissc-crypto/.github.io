<!doctype html>
<html lang="pt-BR" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pok√©mon Quiz Battle</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .star-pulse {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    
    .card-hover {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div id="app" class="w-full h-full overflow-auto"><!-- Content will be rendered here -->
  </div>
  <script>
    const defaultConfig = {
      game_title: "Pok√©mon Quiz Battle",
      welcome_message: "Responda perguntas e ganhe estrelas!",
      background_color: "#f97316",
      card_color: "#ffffff",
      text_color: "#1f2937",
      button_color: "#eab308",
      accent_color: "#fb923c",
      font_family: "system-ui, -apple-system, sans-serif",
      font_size: 16
    };

    let currentUser = null;
    let currentView = 'login';

    // LocalStorage Helper Functions
    function getUsers() {
      const users = localStorage.getItem('quiz_users');
      return users ? JSON.parse(users) : [];
    }

    function saveUsers(users) {
      localStorage.setItem('quiz_users', JSON.stringify(users));
    }

    function getQuestions() {
      const questions = localStorage.getItem('quiz_questions');
      return questions ? JSON.parse(questions) : [];
    }

    function saveQuestions(questions) {
      localStorage.setItem('quiz_questions', JSON.stringify(questions));
    }

    function getUserByUsername(username) {
      return getUsers().find(u => u.username === username);
    }

    function register(username, email, whatsapp, password) {
      const users = getUsers();
      
      if (users.find(u => u.username === username)) {
        showMessage('Nome de usu√°rio j√° existe!', 'error');
        return false;
      }

      const user = {
        id: Date.now().toString(),
        username,
        email,
        whatsapp,
        password,
        stars: 0,
        isAdmin: false,
        createdAt: new Date().toISOString()
      };

      users.push(user);
      saveUsers(users);
      showMessage('Conta criada com sucesso!', 'success');
      return true;
    }

    function login(username, password) {
      const user = getUserByUsername(username);
      if (user && user.password === password) {
        currentUser = user;
        currentView = 'main';
        showMessage(`Bem-vindo, ${username}!`, 'success');
        renderCurrentView();
        return true;
      }
      showMessage('Usu√°rio ou senha incorretos!', 'error');
      return false;
    }

    function loginAsAdmin(password) {
      const ADMIN_PASSWORD = "admin2024";
      
      if (password === ADMIN_PASSWORD) {
        currentUser = {
          id: 'admin',
          username: 'Administrador',
          stars: 999,
          isAdmin: true,
          password: ADMIN_PASSWORD
        };
        currentView = 'main';
        showMessage('Acesso de administrador concedido!', 'success');
        renderCurrentView();
        return true;
      }
      showMessage('Senha de administrador incorreta!', 'error');
      return false;
    }

    function logout() {
      currentUser = null;
      currentView = 'login';
      renderCurrentView();
    }

    function createQuestion(question, answer, pokemon) {
      const questions = getQuestions();
      
      const questionData = {
        id: Date.now().toString(),
        question,
        answer,
        pokemon,
        createdBy: currentUser.username,
        answered: false,
        createdAt: new Date().toISOString()
      };

      questions.push(questionData);
      saveQuestions(questions);
      showMessage('Pergunta criada com sucesso!', 'success');
      renderCurrentView();
      return true;
    }

    function answerQuestion(questionId, isCorrect) {
      if (isCorrect) {
        // Award star to user
        const users = getUsers();
        const userIndex = users.findIndex(u => u.username === currentUser.username);
        if (userIndex !== -1) {
          users[userIndex].stars += 1;
          saveUsers(users);
          currentUser = users[userIndex];
        }
        
        // Mark question as answered
        const questions = getQuestions();
        const questionIndex = questions.findIndex(q => q.id === questionId);
        if (questionIndex !== -1) {
          questions[questionIndex].answered = true;
          saveQuestions(questions);
        }
        
        showMessage('Resposta correta! +1 ‚≠ê', 'success');
        renderCurrentView();
      } else {
        showMessage('Resposta incorreta. Tente novamente!', 'error');
      }
    }

    function modifyStars(username, amount) {
      const users = getUsers();
      const userIndex = users.findIndex(u => u.username === username);
      
      if (userIndex === -1) {
        showMessage('Usu√°rio n√£o encontrado', 'error');
        return;
      }

      users[userIndex].stars = Math.max(0, users[userIndex].stars + amount);
      saveUsers(users);
      
      if (currentUser.username === username) {
        currentUser = users[userIndex];
      }
      
      showMessage(`${amount > 0 ? 'Doou' : 'Retirou'} ${Math.abs(amount)} estrela(s) para ${username}`, 'success');
      renderCurrentView();
    }

    function deleteUser(username) {
      const users = getUsers();
      const filteredUsers = users.filter(u => u.username !== username);
      saveUsers(filteredUsers);
      showMessage(`Usu√°rio ${username} exclu√≠do com sucesso`, 'success');
      renderCurrentView();
    }

    function showMessage(text, type) {
      const messageDiv = document.createElement('div');
      const config = window.elementSdk?.config || defaultConfig;
      const bgColor = type === 'success' ? '#10b981' : '#ef4444';
      
      messageDiv.className = 'fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg text-white font-bold z-50 animate-pulse';
      messageDiv.style.backgroundColor = bgColor;
      messageDiv.textContent = text;
      document.body.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.remove();
      }, 3000);
    }

    function showAdminPasswordModal() {
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const cardColor = config.card_color || defaultConfig.card_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const buttonColor = config.button_color || defaultConfig.button_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;

      const modalDiv = document.createElement('div');
      modalDiv.id = 'admin-modal';
      modalDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
      modalDiv.innerHTML = `
        <div class="w-full max-w-md rounded-3xl shadow-2xl p-8" style="background-color: ${cardColor}; font-family: ${customFont}, ${baseFontStack};">
          <div class="text-center mb-6">
            <div class="text-5xl mb-3">üëë</div>
            <h2 style="color: ${textColor}; font-size: ${baseSize * 1.5}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-2">Acesso Administrativo</h2>
            <p style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="opacity-70">Digite a senha de administrador</p>
          </div>
          
          <form id="admin-password-form" class="space-y-4">
            <input 
              type="password" 
              id="admin-password-input" 
              required
              autofocus
              style="font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
              class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400"
              placeholder="Senha de administrador"
            >
            
            <div class="flex gap-3">
              <button 
                type="button"
                id="cancel-admin-btn"
                style="background-color: ${accentColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
                class="flex-1 py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
                Cancelar
              </button>
              
              <button 
                type="submit"
                style="background-color: ${buttonColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
                class="flex-1 py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
                Entrar
              </button>
            </div>
          </form>
        </div>
      `;
      
      document.body.appendChild(modalDiv);
      
      document.getElementById('admin-password-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const password = document.getElementById('admin-password-input').value;
        loginAsAdmin(password);
        modalDiv.remove();
      });
      
      document.getElementById('cancel-admin-btn').addEventListener('click', () => {
        modalDiv.remove();
      });
      
      modalDiv.addEventListener('click', (e) => {
        if (e.target.id === 'admin-modal') {
          modalDiv.remove();
        }
      });
    }

    function renderCurrentView() {
      const config = window.elementSdk?.config || defaultConfig;
      const app = document.getElementById('app');
      
      if (currentView === 'login') {
        app.innerHTML = renderLoginView(config);
      } else if (currentView === 'main') {
        app.innerHTML = renderMainView(config);
      }
      
      attachEventListeners();
    }

    function renderLoginView(config) {
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const cardColor = config.card_color || defaultConfig.card_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const buttonColor = config.button_color || defaultConfig.button_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      const gameTitle = config.game_title || defaultConfig.game_title;
      const welcomeMessage = config.welcome_message || defaultConfig.welcome_message;

      return `
        <div class="w-full h-full flex items-center justify-center p-4" style="background: linear-gradient(135deg, ${backgroundColor} 0%, ${accentColor} 100%); font-family: ${customFont}, ${baseFontStack};">
          <div class="w-full max-w-md rounded-3xl shadow-2xl p-8" style="background-color: ${cardColor};">
            <div class="text-center mb-8">
              <div class="text-6xl mb-4 star-pulse">üìï‚ö°</div>
              <h1 style="color: ${textColor}; font-size: ${baseSize * 2}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-2">${gameTitle}</h1>
              <p style="color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};" class="opacity-70">${welcomeMessage}</p>
            </div>
            
            <form id="login-form" class="space-y-4">
              <div>
                <label style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="block font-bold mb-2" for="username">Usu√°rio</label>
                <input 
                  type="text" 
                  id="username" 
                  required
                  style="font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
                  class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                  placeholder="Digite seu usu√°rio"
                >
              </div>
              
              <div id="email-field" style="display: none;">
                <label style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="block font-bold mb-2" for="email">E-mail</label>
                <input 
                  type="email" 
                  id="email" 
                  style="font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
                  class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                  placeholder="Digite seu e-mail"
                >
              </div>
              
              <div id="whatsapp-field" style="display: none;">
                <label style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="block font-bold mb-2" for="whatsapp">WhatsApp (com DDD)</label>
                <input 
                  type="tel" 
                  id="whatsapp" 
                  style="font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
                  class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                  placeholder="Ex: 11987654321"
                >
              </div>
              
              <div>
                <label style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="block font-bold mb-2" for="password">Senha</label>
                <input 
                  type="password" 
                  id="password" 
                  required
                  style="font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
                  class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400"
                  placeholder="Digite sua senha"
                >
              </div>
              
              <button 
                type="submit"
                style="background-color: ${buttonColor}; font-size: ${baseSize * 1.125}px; font-family: ${customFont}, ${baseFontStack};"
                class="w-full py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
                Entrar
              </button>
            </form>
            
            <button 
              id="register-btn"
              style="background-color: ${accentColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
              class="w-full mt-4 py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
              Criar Nova Conta
            </button>
            
            <!-- Hidden Admin Access Button -->
            <div class="text-center mt-4">
              <button 
                id="secret-admin-btn"
                style="color: ${textColor}; font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};"
                class="opacity-30 hover:opacity-100 transition-opacity">
                ‚öôÔ∏è
              </button>
            </div>
          </div>
        </div>
      `;
    }

    function renderMainView(config) {
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const cardColor = config.card_color || defaultConfig.card_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const buttonColor = config.button_color || defaultConfig.button_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;
      
      const questions = getQuestions().filter(q => !q.answered);
      const users = getUsers().sort((a, b) => b.stars - a.stars);

      return `
        <div class="w-full h-full" style="background: linear-gradient(135deg, ${backgroundColor} 0%, ${accentColor} 100%); font-family: ${customFont}, ${baseFontStack};">
          <div class="max-w-7xl mx-auto px-4 py-6">
            <!-- Header -->
            <div class="rounded-2xl shadow-lg p-6 mb-6" style="background-color: ${cardColor};">
              <div class="flex flex-wrap justify-between items-center gap-4">
                <div>
                  <h2 style="color: ${textColor}; font-size: ${baseSize * 1.5}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold">üë§ ${currentUser.username} ${currentUser.isAdmin ? 'üëë' : ''}</h2>
                  <p style="color: ${textColor}; font-size: ${baseSize * 1.25}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold">‚≠ê ${currentUser.stars} Estrelas</p>
                  ${currentUser.whatsapp ? `
                    <a href="https://wa.me/55${currentUser.whatsapp}" target="_blank" rel="noopener noreferrer" style="color: #10b981; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold inline-flex items-center gap-1 mt-1 hover:underline">
                      üí¨ Meu WhatsApp
                    </a>
                  ` : ''}
                </div>
                <div>
                  <button 
                    id="logout-btn"
                    style="background-color: ${accentColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
                    class="px-6 py-2 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
                    Sair
                  </button>
                </div>
              </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
              <!-- Questions Section -->
              <div class="lg:col-span-2">
                <div class="rounded-2xl shadow-lg p-6 mb-6" style="background-color: ${cardColor};">
                  <h3 style="color: ${textColor}; font-size: ${baseSize * 1.25}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-4">‚ùì Perguntas Dispon√≠veis (${questions.length} sem limite!)</h3>
                  
                  <div class="space-y-4 max-h-96 overflow-y-auto">
                    ${questions.length === 0 ? `
                      <p style="color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};" class="text-center opacity-70 py-8">Nenhuma pergunta dispon√≠vel. Crie a primeira!</p>
                    ` : questions.map(q => {
                      const creator = getUserByUsername(q.createdBy);
                      return `
                      <div class="card-hover rounded-lg p-4 border-2" style="border-color: ${accentColor}; background-color: ${cardColor};">
                        <p style="color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-2">üéØ ${q.question}</p>
                        <div class="flex items-center justify-between mb-3">
                          <p style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="opacity-70">Por: ${q.createdBy}</p>
                          ${creator && creator.whatsapp ? `
                            <a href="https://wa.me/55${creator.whatsapp}?text=Oi%20${encodeURIComponent(q.createdBy)}!%20Vi%20sua%20pergunta:%20${encodeURIComponent(q.question)}" target="_blank" rel="noopener noreferrer" style="color: #10b981; font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold hover:underline">
                              üí¨ Contato
                            </a>
                          ` : ''}
                        </div>
                        <button 
                          onclick="showAnswerInput('${q.id}')"
                          style="background-color: ${buttonColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};"
                          class="w-full py-2 rounded text-white font-bold hover:opacity-90 transition-opacity">
                          Responder
                        </button>
                        <div id="answer-area-${q.id}" style="display: none;" class="mt-2 space-y-2">
                          <input 
                            type="text" 
                            id="answer-${q.id}" 
                            placeholder="Digite sua resposta"
                            style="font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
                            class="w-full px-3 py-2 rounded border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                          <button 
                            onclick="submitAnswer('${q.id}', '${q.answer}')"
                            style="background-color: #10b981; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};"
                            class="w-full py-2 rounded text-white font-bold hover:opacity-90 transition-opacity">
                            Confirmar Resposta
                          </button>
                        </div>
                      </div>
                    `}).join('')}
                  </div>
                </div>

                <!-- Create Question -->
                <div class="rounded-2xl shadow-lg p-6" style="background-color: ${cardColor};">
                  <h3 style="color: ${textColor}; font-size: ${baseSize * 1.25}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-4">‚ûï Criar Nova Pergunta (Sem Limite! üéâ)</h3>
                  
                  <button 
                    id="show-question-form-btn"
                    style="background-color: ${buttonColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
                    class="w-full py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
                    Nova Pergunta
                  </button>
                  
                  <form id="question-form" class="space-y-3 mt-4" style="display: none;">
                    <input 
                      type="text" 
                      id="new-question" 
                      required
                      placeholder="Qual √© a pergunta?"
                      style="font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
                      class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                    
                    <input 
                      type="text" 
                      id="new-answer" 
                      required
                      placeholder="Qual √© a resposta?"
                      style="font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack}; border-color: ${accentColor};"
                      class="w-full px-4 py-3 rounded-lg border-2 focus:outline-none focus:ring-2 focus:ring-yellow-400">
                    
                    <button 
                      type="submit"
                      style="background-color: #10b981; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
                      class="w-full py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
                      Criar Pergunta
                    </button>
                  </form>
                </div>
              </div>

              <!-- Sidebar -->
              <div class="space-y-6">
                <!-- Ranking -->
                <div class="rounded-2xl shadow-lg p-6" style="background-color: ${cardColor};">
                  <h3 style="color: ${textColor}; font-size: ${baseSize * 1.25}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-4">üèÜ Ranking</h3>
                  <div class="space-y-3">
                    ${users.slice(0, 10).map((user, index) => `
                      <div class="flex justify-between items-center p-2 rounded" style="background-color: ${index < 3 ? accentColor + '20' : 'transparent'};">
                        <div class="flex items-center gap-2">
                          <span style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold">${index + 1}. ${user.username} ${user.isAdmin ? 'üëë' : ''}</span>
                          ${user.whatsapp ? `
                            <a href="https://wa.me/55${user.whatsapp}?text=Oi%20${encodeURIComponent(user.username)}!" target="_blank" rel="noopener noreferrer" style="color: #10b981; font-size: ${baseSize * 0.75}px;" class="hover:opacity-70" title="Chamar no WhatsApp">
                              üí¨
                            </a>
                          ` : ''}
                        </div>
                        <span style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold">‚≠ê ${user.stars}</span>
                      </div>
                    `).join('')}
                  </div>
                </div>

                <!-- Admin Panel -->
                ${currentUser.isAdmin ? `
                  <div class="rounded-2xl shadow-lg p-6" style="background-color: ${cardColor};">
                    <h3 style="color: ${textColor}; font-size: ${baseSize * 1.25}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-4">üëë Painel Admin</h3>
                    
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                      ${users.length === 0 ? `
                        <p style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="text-center opacity-70 py-4">Nenhum jogador registrado</p>
                      ` : users.map(user => `
                        <div class="border-2 rounded-lg p-3" style="border-color: ${accentColor};">
                          <div class="flex justify-between items-center mb-2">
                            <span style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold">üë§ ${user.username}</span>
                            <span style="color: ${textColor}; font-size: ${baseSize * 0.875}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold">‚≠ê ${user.stars}</span>
                          </div>
                          ${user.whatsapp ? `
                            <p style="color: ${textColor}; font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};" class="opacity-70 mb-2">üì± ${user.whatsapp}</p>
                          ` : ''}
                          
                          <div class="flex gap-2">
                            <button 
                              onclick="adminAddStar('${user.username}')"
                              style="background-color: #10b981; font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};"
                              class="flex-1 py-1 rounded text-white font-bold hover:opacity-90 transition-opacity">
                              +1 ‚≠ê
                            </button>
                            
                            <button 
                              onclick="adminRemoveStar('${user.username}')"
                              style="background-color: ${buttonColor}; font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};"
                              class="flex-1 py-1 rounded text-white font-bold hover:opacity-90 transition-opacity">
                              -1 ‚≠ê
                            </button>
                            
                            <button 
                              onclick="adminDeleteUser('${user.username}')"
                              style="background-color: #ef4444; font-size: ${baseSize * 0.75}px; font-family: ${customFont}, ${baseFontStack};"
                              class="flex-1 py-1 rounded text-white font-bold hover:opacity-90 transition-opacity">
                              üóëÔ∏è
                            </button>
                          </div>
                        </div>
                      `).join('')}
                    </div>
                  </div>
                ` : ''}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function attachEventListeners() {
      const loginForm = document.getElementById('login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const username = document.getElementById('username').value;
          const password = document.getElementById('password').value;
          login(username, password);
        });
      }

      const registerBtn = document.getElementById('register-btn');
      if (registerBtn) {
        registerBtn.addEventListener('click', () => {
          const emailField = document.getElementById('email-field');
          const whatsappField = document.getElementById('whatsapp-field');
          const emailInput = document.getElementById('email');
          const whatsappInput = document.getElementById('whatsapp');
          
          if (emailField.style.display === 'none') {
            emailField.style.display = 'block';
            whatsappField.style.display = 'block';
            emailInput.required = true;
            whatsappInput.required = true;
            showMessage('Preencha e-mail e WhatsApp para criar a conta', 'success');
            return;
          }
          
          const username = document.getElementById('username').value;
          const email = emailInput.value;
          const whatsapp = whatsappInput.value;
          const password = document.getElementById('password').value;
          
          if (!username || !email || !whatsapp || !password) {
            showMessage('Preencha todos os campos', 'error');
            return;
          }
          
          const success = register(username, email, whatsapp, password);
          if (success) {
            emailField.style.display = 'none';
            whatsappField.style.display = 'none';
            emailInput.required = false;
            whatsappInput.required = false;
            emailInput.value = '';
            whatsappInput.value = '';
          }
        });
      }

      const secretAdminBtn = document.getElementById('secret-admin-btn');
      if (secretAdminBtn) {
        secretAdminBtn.addEventListener('click', () => {
          showAdminPasswordModal();
        });
      }

      const logoutBtn = document.getElementById('logout-btn');
      if (logoutBtn) {
        logoutBtn.addEventListener('click', logout);
      }

      const questionForm = document.getElementById('question-form');
      if (questionForm) {
        questionForm.addEventListener('submit', (e) => {
          e.preventDefault();
          const question = document.getElementById('new-question').value;
          const answer = document.getElementById('new-answer').value;
          
          createQuestion(question, answer, '');
          questionForm.reset();
          questionForm.style.display = 'none';
        });
      }

      const showQuestionFormBtn = document.getElementById('show-question-form-btn');
      if (showQuestionFormBtn) {
        showQuestionFormBtn.addEventListener('click', () => {
          const form = document.getElementById('question-form');
          if (form) {
            form.style.display = form.style.display === 'none' ? 'block' : 'none';
          }
        });
      }
    }

    window.submitAnswer = function(questionId, correctAnswer) {
      const answerInput = document.getElementById(`answer-${questionId}`);
      const userAnswer = answerInput.value.trim().toLowerCase();
      
      if (!userAnswer) {
        showMessage('Digite uma resposta!', 'error');
        return;
      }
      
      const isCorrect = userAnswer === correctAnswer.toLowerCase();
      answerQuestion(questionId, isCorrect);
      answerInput.value = '';
      
      const answerArea = document.getElementById(`answer-area-${questionId}`);
      if (answerArea) {
        answerArea.style.display = 'none';
      }
    };

    window.showAnswerInput = function(questionId) {
      const answerArea = document.getElementById(`answer-area-${questionId}`);
      if (answerArea) {
        answerArea.style.display = answerArea.style.display === 'none' ? 'block' : 'none';
      }
    };

    window.adminAddStar = function(username) {
      modifyStars(username, 1);
    };

    window.adminRemoveStar = function(username) {
      modifyStars(username, -1);
    };

    window.adminDeleteUser = function(username) {
      const config = window.elementSdk?.config || defaultConfig;
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      const cardColor = config.card_color || defaultConfig.card_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const buttonColor = config.button_color || defaultConfig.button_color;
      const accentColor = config.accent_color || defaultConfig.accent_color;

      const confirmDiv = document.createElement('div');
      confirmDiv.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50';
      confirmDiv.innerHTML = `
        <div class="w-full max-w-md rounded-2xl shadow-2xl p-6" style="background-color: ${cardColor}; font-family: ${customFont}, ${baseFontStack};">
          <div class="text-center mb-4">
            <div class="text-4xl mb-2">‚ö†Ô∏è</div>
            <h3 style="color: ${textColor}; font-size: ${baseSize * 1.25}px; font-family: ${customFont}, ${baseFontStack};" class="font-bold mb-2">Confirmar Exclus√£o</h3>
            <p style="color: ${textColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};">Tem certeza que deseja excluir o usu√°rio <strong>${username}</strong>?</p>
          </div>
          
          <div class="flex gap-3">
            <button 
              id="cancel-delete-btn"
              style="background-color: ${accentColor}; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
              class="flex-1 py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
              Cancelar
            </button>
            
            <button 
              id="confirm-delete-btn"
              style="background-color: #ef4444; font-size: ${baseSize}px; font-family: ${customFont}, ${baseFontStack};"
              class="flex-1 py-3 rounded-lg text-white font-bold hover:opacity-90 transition-opacity">
              Excluir
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(confirmDiv);
      
      document.getElementById('cancel-delete-btn').addEventListener('click', () => {
        confirmDiv.remove();
      });
      
      document.getElementById('confirm-delete-btn').addEventListener('click', () => {
        deleteUser(username);
        confirmDiv.remove();
      });

      confirmDiv.addEventListener('click', (e) => {
        if (e.target === confirmDiv) {
          confirmDiv.remove();
        }
      });
    };

    async function onConfigChange(config) {
      renderCurrentView();
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.card_color || defaultConfig.card_color,
              set: (value) => {
                config.card_color = value;
                window.elementSdk.setConfig({ card_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.button_color || defaultConfig.button_color,
              set: (value) => {
                config.button_color = value;
                window.elementSdk.setConfig({ button_color: value });
              }
            },
            {
              get: () => config.accent_color || defaultConfig.accent_color,
              set: (value) => {
                config.accent_color = value;
                window.elementSdk.setConfig({ accent_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["game_title", config.game_title || defaultConfig.game_title],
          ["welcome_message", config.welcome_message || defaultConfig.welcome_message]
        ])
      });
    }

    // Initialize app
    renderCurrentView();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b5c9c5fa2305e0f',t:'MTc2NzA0NjA1MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
